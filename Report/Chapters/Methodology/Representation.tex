\section{Genotype}
\label{methodology_genotype}
It is generally inefficient to perform search on a direct representation\footnote{A direct representation is where every part of the content has a corresponding variable in the representation.} of the content that is being generated. Due to this, it is generally a good idea to create a less-direct and simpler representation, as that is faster to work with. This type of representation is known as a "genotype" in evolutionary programming.

There are two important principles to keep in mind when choosing how to represent the genotype; dimensionality and locality. In most cases, a more direct representation will allow the search algorithm to be more precise in its search, but will also increase the size (dimension) of the search space. This increase in dimension will (in general) make it harder to find any specific solution. Locality refers to the correlation between the size of changes in the chosen representation and the content that the genotype represents. It is often desirable to have high locality, meaning that small changes in representation will also result in a small change in the content\cite{togelius2015searchbased}. In order to reduce the search problem to its core, it is important choose a representation that offers a good compromise between high locality and size of the search space. 

In the search algorithms, a solution (StarCraft II map) is represented as a two-part data structure. The first part is a base map generated by a cellular automata (see section \ref{methodology_ca}), which contains only different height levels, cliffs, and impassable terrain. The second part is a set of \textit{map points} which represent positions where different map elements will be placed on one half of the map. Because only the top half of the map is being generated and then rotated, the size of the search space is reduced from quadratic to linear in the number of possible tile arrangements. In addition, it means a number of assumptions can be made when checking constraints, e.g. there is no need to check if there is exactly the same number of expansions accessible for each player.

The distinction between map layout and map elements makes it possible to separate the search space into a two-layered search space. The base maps generated by the cellular automata make up the first layer. The second layer consists of all the possible combinations of map points. The layering of search spaces means that the size of the search space depends on the number of base maps that are being searched. Thus if the cellular automata generates base maps that has high potential for being good StarCraft II maps, the evolutionary and novelty searches can focus on the placement and amount of map elements on the map. With this approach, it is less likely that the search encounters the problems usually seen when dealing with very large search spaces. However, it also means that the same set of map points are likely to produce very different results when combined with different base maps (see figure \ref{fig:methodology_genotype_differentbasemaps}).

\insertTwoPictures{Generated_Map_Example1}{Generated_Map_Example2}{Two generated maps that share the same map points, but have a different base map.}{methodology_genotype_differentbasemaps}

\subsection{Map Points}
\label{methodology_genotype_mappoints}
A map point in the genotype is a combination of a distance, an angle, and a type. The distance is a number between zero and one that is relative to the size of the map that the point will be placed on, where zero is the centre of the map and one is at the edge of the map. The angle is a number between 0 and 180 where 0 is east, 90 is north, and 180 is west. The type of the map point determines which map element will be placed at the position. Figure \ref{fig:methodology_genotype_mappoints_xelnagatower} shows a Xel'Naga tower placed at 45 degrees at 0.5 distance on a size 32-by-32 map.

\insertPicture{0.4}{XelNagaTowerPlacement}{The placement of a Xel'Naga tower at 45 degrees and 0.5 distance on a 32-by-32 map. The two 2x2 squares with a black tower indicate a Xel'Naga tower.}{methodology_genotype_mappoints_xelnagatower}

As long as the same base map is being searched, any small change to the degree or distance of a map point will result in small change to the generated map\footnote{With the exception of ramps, as they are placed using a different method than the other map points. This is discussed further in section \ref{methodology_conversion}}. In contrast, changes to the type of a map point or changes to the amount of map points in a representation has potential for large changes in the generated map. This is mainly relevant for bases, as the number of bases and the distance to them from the start base has a large impact on the quality of the map.

The different types of map points are the following: \textbf{StartBase} (a starting base), \textbf{Base} (a regular base with regular minerals), \textbf{GoldBase} (a regular base with high-value minerals), \textbf{XelNagaTower} (a Xel'Naga tower that grants vision), \textbf{Ramp} (a ramp between height levels), and \textbf{DestructibleRocks} (destructible rocks that blocks building placement and pathing).

\subsection{Initialization \& Variation}
\label{methodology_genotype_initialization}
When creating the initial population used for searches, a number of map points with random distance and angle are generated for each individual in the population. The number of map points generated is dependent on a set of constraints, e.g. exactly one starting base point and between one and four normal bases are generated. This increases the likelihood of a solution being feasible, since the number of map points in an individual in the initial population never fall below or go above the constraints of each type of map element.

As previously noted, the search space is separated into two layers. A cellular automata is used to generate a base map (a point in the first layer) and the search algorithms traverse the second layer using the map points. In order for this traversal to happen, mutation (a unary variation operator) is applied to the set of map points in order to produce a different solution. When a solution is mutated, each map point has a chance of being mutated, producing a new map point with slightly modified angle and/or distance. The new set of map points consist of the map points that were not mutated and the newly produced map points from mutation. From this new set, there is a chance that a random map point is added and a chance that a map point is removed, but without going outside the constraints. Once this process is complete, a set of map points have been mutated.